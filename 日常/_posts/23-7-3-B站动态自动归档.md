平时都在B站上看视频并随手用B站动态记笔记，留下思维线索。
需要一个js小工具把随手发在B站的笔记自动摘抄下来，
包括笔记不幸被吞的情况，最好也能及时抄录。
……现成的看来没有，自己写吧。

#### 抄录
```js
a=[...document.querySelectorAll('.bili-rich-text__content>span')]
console.log(a.length)
console.assert(a.length==13)
a.forEach(a=>a.style='color:silver')
a.map(a=>a.innerHTML)
```


###### 3
```js
a=[...document.querySelectorAll('.bili-dyn-item__main')]
a=a.map(a=>{
	a.style='background:gray';
	return[a.querySelector('.bili-dyn-time').innerHTML.trim(),
		a.querySelector('.bili-rich-text__content').innerHTML]})
///本地保存
localStorage.archives=JSON.stringify(a)
b=JSON.parse(localStorage.archives)
```

#### 解析日期
```js
d=new Date().setHours(0,0,0,0)
new Date().toLocaleDateString()

a=JSON.parse(localStorage.archives)
a=a.map(a=>{
	a.style='background:gray';
	return[a.querySelector('.bili-dyn-time').innerHTML.trim(),
		a.querySelector('.bili-rich-text__content').innerHTML]})
///本地保存
localStorage.archives2=JSON.stringify(a)
b=JSON.parse(localStorage.archives2)
```
## 解析JSON
从JSON能取到完整的发布时间。
```js
nextPg=offset=>`https://api.bilibili.com/x/polymer/web-dynamic/v1/feed/space?offset=${offset}&host_mid=28748982&timezone_offset=-480&features=itemOpusStyle`
a=JSON.parse(document.body.firstChild.innerHTML).data
;[a.items.map(a=>{
	time=new Date(a.modules.module_author.pub_ts*1000).toLocaleString()
	a=a.modules.module_dynamic.desc
	a={a:a.text,b:a.rich_text_nodes[0].text,c:a.rich_text_nodes[0].orig_text}
	console.assert(a.a==a.b&&a.b==a.c,a)
	return[time,a.a]
}),nextPg(a.offset)]
```

#### 获取
```js
a='https://api.bilibili.com/x/polymer/web-dynamic/v1/feed/space?offset=&host_mid=28748982&timezone_offset=-480&features=itemOpusStyle'
async function fetchAsync () {
  //let response = await fetch('https://api.github.com');
  let response = await fetch('https://api.bilibili.com/x/polymer/web-dynamic/v1/feed/space?offset=814430716784803879&host_mid=28748982&timezone_offset=-480&features=itemOpusStyle')
  let data = await response.json();
  return data;
}
fetchAsync().then(data => console.log(data))
    .catch(reason => console.log(reason.message))
```
两个思路
1. 读已经下载的、load cached/stored fetch
2. 在fetch中加上cookie
3. 不过还是先手工开页面吧……毕竟只是要转录自己的几条动态……

#### 加载缓存
初步试了一下，似乎可行。可行的话肯定比纯手工省事些……
```js
a='https://api.bilibili.com/x/polymer/web-dynamic/v1/feed/space?offset=&host_mid=28748982&timezone_offset=-480&features=itemOpusStyle'
fetch(a,{mode:'same-origin',cache:'only-if-cached'}).then(r=>r.json()).then(r=>console.log(r)).catch(error => console.error(error))

```

```js
a='https://api.bilibili.com/x/polymer/web-dynamic/v1/feed/space?offset=&host_mid=28748982&timezone_offset=-480&features=itemOpusStyle'
fetch(a,{mode:'same-origin',cache:'only-if-cached'})
	.then(r=>{
		if(r.ok){console.log('Cached')}else if(r.status==504){console.log('Not cached')}
		return r.json()
	})
	.then(r=>console.log(r))
	.catch(()=>{console.log('Network error')})
```